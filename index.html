<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="format-detection" content="telephone=no">
    <title>通讯录查询系统</title>
    <!-- 引入Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入图标库 -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <style type="text/tailwindcss">
        @layer utilities {
            .table-responsive {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch; /* 移动端滚动优化 */
            }
            .shadow-custom {
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }
            /* 强制文字横向显示，禁止竖排 */
            .text-no-vertical {
                white-space: nowrap;
                text-wrap: nowrap;
                writing-mode: horizontal-tb;
            }
            /* 下拉建议框样式 */
            .suggestion-list {
                max-height: 200px;
                overflow-y: auto;
                z-index: 10;
            }
            .suggestion-item {
                cursor: pointer;
                transition: background-color 0.2s;
            }
            .suggestion-item:hover {
                background-color: #e0e7ff;
            }
            /* 无匹配单位提示样式 */
            .no-company-tip {
                color: #ef4444;
                font-size: 0.875rem;
                margin-top: 0.5rem;
                display: none;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- 页面容器 -->
    <div class="container mx-auto px-4 py-6 max-w-7xl">
        <!-- 标题 -->
        <h1 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-gray-800 mb-6 text-center text-no-vertical">
            <i class="fa fa-address-book-o mr-2"></i>单位联系人查询
            <span class="text-sm font-normal text-gray-500 ml-2">(收录于2025年12月)</span>
        </h1>
<p class="text-center text-sm text-gray-400 mb-4 text-no-vertical">参考号码，不保证完全准确！</p>
        <!-- 仅保留单位筛选区域 -->
        <div class="mb-6 relative">
            <label class="block text-sm font-medium text-gray-700 mb-1 text-no-vertical">单位筛选（从下拉框选择）：</label>
            <input 
                type="text" 
                id="companyFilterInput"
                placeholder="输入单位名称关键词筛选（支持模糊匹配）"
                class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent pl-10 text-no-vertical"
            >
            <i class="fa fa-building-o absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
            <!-- 单位建议下拉框 -->
            <div id="companySuggestions" class="suggestion-list hidden absolute left-0 right-0 mt-1 bg-white rounded-lg shadow-lg border border-gray-200 py-1">
            </div>
            <!-- 无匹配单位提示 -->
            <div id="noCompanyTip" class="no-company-tip text-no-vertical">
                <i class="fa fa-exclamation-circle mr-1"></i>暂无该单位的通讯录收录
            </div>
        </div>

        <!-- 当前筛选单位提示 -->
        <div id="currentFilterTip" class="mb-4 hidden text-sm text-blue-600 font-medium">
            <i class="fa fa-filter mr-1"></i>
            当前筛选：<span id="currentCompanyName"></span> 
            <button id="clearCompanyFilter" class="text-red-600 hover:underline ml-2 text-xs">
                清除筛选
            </button>
        </div>

        <!-- 重置按钮（单独显示） -->
        <div class="mb-4">
            <button 
                id="resetBtn"
                class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition-colors duration-300 whitespace-nowrap"
            >
                <i class="fa fa-refresh mr-1"></i>重置所有筛选
            </button>
        </div>

        <!-- 通讯录表格（新增省份列） -->
        <div class="bg-white rounded-lg shadow-custom overflow-hidden table-responsive">
            <table class="w-full text-left border-collapse min-w-[700px]">
                <thead class="bg-blue-600 text-white">
                    <tr>
                        <th class="px-3 py-2 sm:px-4 text-no-vertical">省份</th>
                        <th class="px-3 py-2 sm:px-4 text-no-vertical">单位名称(向右滑动查看号码)</th>
                        <th class="px-3 py-2 sm:px-4 text-no-vertical">联系人</th>
                        <th class="px-3 py-2 sm:px-4 text-no-vertical">联系人职务</th>
                        <th class="px-3 py-2 sm:px-4 text-no-vertical">联系人电话</th>
                        <th class="px-3 py-2 sm:px-4 text-center text-no-vertical">操作</th>
                    </tr>
                </thead>
                <tbody id="contactTable">
                    <!-- 数据行由JS动态生成 -->
                </tbody>
            </table>
        </div>

        <!-- 空数据提示 -->
        <div id="emptyTip" class="hidden text-center py-10 text-gray-500">
            <i class="fa fa-inbox text-3xl mb-2"></i>
            <p class="text-no-vertical">暂无匹配的通讯录数据</p>
        </div>
    </div>

    <!-- 关联项目弹窗 -->
    <div id="projectModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg w-full max-w-md mx-4 shadow-lg">
            <div class="flex justify-between items-center px-6 py-4 border-b">
                <h3 class="font-bold text-lg text-no-vertical">关联项目</h3>
                <button id="closeModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fa fa-times text-xl"></i>
                </button>
            </div>
            <div class="px-6 py-4 max-h-60 overflow-y-auto" id="projectList">
                <!-- 关联项目列表由JS动态生成 -->
            </div>
            <div class="px-6 py-4 border-t flex justify-end">
                <button id="confirmModal" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-no-vertical">
                    返回
                </button>
            </div>
        </div>
    </div>

    <script>
        // ====================== 【仅需修改这里的二维数组即可更新通讯录】 ======================
        // 通讯录核心数据 - 二维数组格式（第1列=省份，第2列=单位名称，第3列=联系人，第4列=职务，第5列=电话，第6列=关联项目）
        const templateData = [
             ["四川", "四川省中悦建设工程有限公司", "陈延东", "现场负责人", "15215023670", "巴南区木洞应急水厂扩能改造工程"],
			  ["四川", "四川省中悦建设工程有限公司", "陈延东", "现场负责人", "15215023670", "测试项目a"],
["四川", "四川省交通建设集团有限责任公司", "蔡华", "现场负责人", "18215591066", "成都市第八再生水厂再生水综合提升标段"],
["重庆", "重庆蓬源建筑工程有限公司", "柯昌波", "项目负责人", "19923066668", "城口县城公共供水管网漏损治理及智能化改造项目"],
["重庆", "重庆绿逸建设开发有限责任公司", "伍建", "现场负责人", "13896298997", "城口县复兴街道葛城街道排水管网改扩建工程"],
["重庆", "重庆绿逸建设开发有限责任公司", "徐相余", "现场负责人", "13983506657", "城口县龙田及北屏片区污水收集管网建设项目"],
["四川", "四川煜水桥建筑工程有限公司", "崔善峰", "现场安装执行", "15329718608", "赤水市官长片区农村规模化供水工程"],
["四川", "四川佰业弘建筑工程有限公司", "范松", "法人代表", "15775959895", "达川区水源及供水保障工程-大堰镇、管村镇等场镇及社区供水管网连通及巩固提升工程"],
["四川", "四川聚其建筑工程有限公司", "敬宏亚", "现场项目经理", "15308300705", "大英县城镇污水处理厂优化提升改造及设施设备更新项目"],
["四川", "四川茂安建设有限公司", "廖忠勇", "现场负责人", "18783620666", "德格县麦宿镇供水管网改造项目"],
["四川", "四川纹江致远建筑开发工程有限公司", "张贵强", "现场负责人", "18008048662", "德阳市罗江区乡村水务供水工程建设项目"],
["重庆", "重庆浩宏建设有限公司", "李富云", "项目经理", "13896668699", "涪陵区新妙片石沱区区农村移民安置区供水"],
["四川", "四川浩荣鼎建筑工程有限公司", "杨鑫", "现场负责人", "13980392382", "高县西区自来水厂及配套管网二期工程"],
["四川", "四川锐问建设工程有限公司", "袁政", "现场负责人", "15196202147", "黑水县西尔镇市政供水基础设施建设项目"],
["四川", "四川中铭建设有限公司", "张良", "采购总", "17736827128", "洪雅县供水设施提升工程EPC"],
["四川", "四川栎宸建设工程有限公司", "张恒", "项目部", "15982174202", "花源自来水厂取水保障工程"],
["四川", "中外建设（四川）有限公司", "王廷", "法人代表", "18190695247", "泸定县新城自来水厂取水及输配水管网工程"],
["四川", "四川亿舱建设工程有限公司", "张平", "现场负责人", "13708286515", "泸县神仙桥化工园区企业配套服务工程供水项目一期"],
["四川", "四川伟煜建设工程有限公司", "邓松阳", "(空白)", "15228227107", "泸州市泸县三溪口水库灌区2023-2025年续建配套与节水改造项目"],
["四川", "四川冉东建设工程有限公司", "王先生", "现场负责人", "13158899815", "绵阳市梓潼县武都引水二期灌区工程仁和镇"],
["四川", "四川省第六建筑有限公司", "蔡欣", "项目部", "18180799182", "绵竹市城市供水能力提升及智慧化改造项目"],
["重庆", "重庆市耀纵建筑工程有限公司", "张儒圆", "项目负责人", "13594407094", "彭水县黄荆水库工程"],
["四川", "中建长江佳成（四川）水利工程有限公司", "吕万华", "项目经理", "13990106832", "晴隆县普岔河水库工程"],
["四川", "四川捷成慧达建设工程有限公司", "王志威", "现场项目负责人", "15608097959", "生物城高区条条河以西铁东快线以东供水保障工程"],
["重庆", "中交三公局第四工程建设（重庆）有限公司", "开继平", "现场项目经理", "13577964720", "水土新城北部片区排水管道项目一期水土新城雨、污水管网修复工程"],
["重庆", "重庆对外建设（集团）有限公司", "李林", "现场负责人", "13508302809", "遂宁市主城区河西片区污水处理设施及配套工程升级改造项目EPC"],
["重庆", "重庆市万盛区顺达公路开发有限责任公司", "梁正平", "现场负责人", "15730143403", "万盛经开区平山园区管网修复工程煤电化园区部分"],
["四川", "四川华霖建筑工程有限公司", "安辉", "现场项目经理", "13548383333", "小金县原水输水管道及水厂配套建设项目"],
["四川", "四川中坤镒建设工程有限公司", "廖超", "现场负责人", "13551402475", "宣汉县乡村振兴西北部水源保障工程"],
["四川", "四川省建海建设有限公司", "索郎罗布", "现场负责人", "13322520951", "亚东县县城供水提质增效项目EPC"],
["四川", "四川顺发天腾建设工程有限责任公司", "何毅", "项目经理", "18583779977", "仪陇县小型灌溉工程标准化建设项目"],
["四川", "四川省第四建筑有限公司", "张茂林", "项目经理", "13882231207", "营山县城市供水提升改造项目设计施工总承包一标段"],
["四川", "四川省发展国润水务投资有限公司", "莫舒文", "项目经理", "18613227612", "营山县城乡供水标准化建设"],
["四川", "四川晨沐建设工程有限公司", "邓世明", "现场负责人", "13890112918", "游仙街道办石马镇部分渠道恢复供水功能项目"],
["重庆", "重庆泽润水务有限公司", "石流", "现场技术负责人", "18875327789", "忠县2025年农村供水水源抗旱及城乡供水一体化工程,忠县移民安置区江北片区供水保障提升工程"],
["重庆", "重庆拓开建设有限公司", "王蜀轩", "现场负责人", "15320696666", "重庆市开州区金峰、厚坝等农村供水一改三提工程,重庆市开州区赵家、渠口等农村供水一改三提工程"],
["四川", "四川谦源建筑工程有限公司", "陈元衡", "现场负责人", "13595488358", "重庆市綦江区小型灌区项目施工梅家沟片区"]
            // 新增数据示例：["省份", "单位名称", "联系人", "职务", "电话", "关联项目"]
           ];
        // ====================== 【数据修改结束】 ======================

        // 全局变量
        let contactData = []; // 处理后的完整数据
        let allCompanies = []; // 所有唯一单位列表
        let currentFilterCompany = ''; // 当前选中的筛选单位

        // DOM元素提前获取
        const contactTable = document.getElementById('contactTable');
        const emptyTip = document.getElementById('emptyTip');
        const projectModal = document.getElementById('projectModal');
        const projectList = document.getElementById('projectList');
        const closeModal = document.getElementById('closeModal');
        const confirmModal = document.getElementById('confirmModal');
        const resetBtn = document.getElementById('resetBtn');
        const clearCompanyFilterBtn = document.getElementById('clearCompanyFilter');
        const noCompanyTip = document.getElementById('noCompanyTip');
        const companySuggestions = document.getElementById('companySuggestions');

        // 处理二维数组，转换为程序可用的格式，并合并相同单位相同联系人的关联项目
        function processTemplateData(rawData) {
            const processedData = [];
            const companiesSet = new Set(); // 用于去重存储单位名称
            const uniqueKeyMap = new Map(); // 用于跟踪唯一记录的索引
            
            // 遍历数组（跳过第一行表头）
            rawData.forEach(row => {
                // 确保每行有至少5个必填字段（省份、单位、联系人、职务、电话）
                if (row.length >= 5) {
                    const province = row[0] || '';
                    const company = row[1] || '';
                    const name = row[2] || '';
                    const position = row[3] || '';
                    const phone = row[4] || '';
                    
                    // 生成唯一标识键（单位+联系人+电话）
                    const uniqueKey = `${company}|${name}|${phone}`;
                    
                    // 当前行的关联项目
                    const currentProjects = row[5] ? 
                        row[5].split(',').map(p => p.trim()).filter(p => p) : [];
                    
                    // 检查是否已存在相同记录
                    if (uniqueKeyMap.has(uniqueKey)) {
                        // 如果存在，合并关联项目（去重）
                        const existingIndex = uniqueKeyMap.get(uniqueKey);
                        const existingItem = processedData[existingIndex];
                        
                        // 合并项目并去重
                        const allProjects = [...existingItem.projects, ...currentProjects];
                        existingItem.projects = [...new Set(allProjects)];
                    } else {
                        // 如果不存在，添加新记录
                        const newItem = {
                            province: province,
                            company: company,
                            name: name,
                            position: position,
                            phone: phone,
                            projects: currentProjects
                        };
                        
                        processedData.push(newItem);
                        uniqueKeyMap.set(uniqueKey, processedData.length - 1);
                        if (company) companiesSet.add(company);
                    }
                }
            });

            // 转换为数组并排序
            allCompanies = Array.from(companiesSet).sort();
            return processedData;
        }

        // 获取单位建议列表
        function getCompanySuggestions(keyword) {
            if (!keyword) return [];
            const lowerKeyword = keyword.toLowerCase();
            return allCompanies.filter(company => 
                company.toLowerCase().includes(lowerKeyword)
            );
        }

        // 渲染单位建议下拉框 + 无匹配提示
        function renderCompanySuggestions(keyword) {
            const suggestions = getCompanySuggestions(keyword);
            
            // 隐藏/显示无匹配提示
            if (keyword && suggestions.length === 0) {
                noCompanyTip.style.display = 'block';
                companySuggestions.classList.add('hidden');
            } else {
                noCompanyTip.style.display = 'none';
                if (suggestions.length === 0 || !keyword) {
                    companySuggestions.classList.add('hidden');
                    return;
                }

                // 生成建议列表
                companySuggestions.innerHTML = '';
                suggestions.forEach(company => {
                    const item = document.createElement('div');
                    item.className = 'suggestion-item px-4 py-2 text-no-vertical';
                    item.textContent = company;
                    item.dataset.company = company;
                    companySuggestions.appendChild(item);

                    // 点击建议项选中单位
                    item.addEventListener('click', function() {
                        const selectedCompany = this.dataset.company;
                        currentFilterCompany = selectedCompany;
                        // 更新输入框值
                        document.getElementById('companyFilterInput').value = selectedCompany;
                        // 隐藏建议框和无匹配提示
                        companySuggestions.classList.add('hidden');
                        noCompanyTip.style.display = 'none';
                        // 显示筛选提示
                        showFilterTip(selectedCompany);
                        // 筛选并渲染表格
                        filterAndRenderTable();
                    });
                });

                companySuggestions.classList.remove('hidden');
            }
        }

        // 显示筛选提示
        function showFilterTip(companyName) {
            const filterTipEl = document.getElementById('currentFilterTip');
            const companyNameEl = document.getElementById('currentCompanyName');
            
            companyNameEl.textContent = companyName;
            filterTipEl.classList.remove('hidden');
        }

        // 清除单位筛选
        function clearCompanyFilter() {
            currentFilterCompany = '';
            document.getElementById('companyFilterInput').value = '';
            document.getElementById('currentFilterTip').classList.add('hidden');
            noCompanyTip.style.display = 'none'; // 清除提示
            filterAndRenderTable();
        }

        // 筛选并渲染表格（仅按单位筛选）
        function filterAndRenderTable() {
            // 按单位筛选
            let filteredData = contactData;
            if (currentFilterCompany) {
                filteredData = contactData.filter(item => 
                    item.company === currentFilterCompany
                );
            }

            // 渲染表格
            initTable(filteredData);
        }

        // 初始化表格（适配新增的省份列）
        function initTable(data) {
            contactTable.innerHTML = '';
            emptyTip.classList.add('hidden');
            
            if (data.length === 0) {
                emptyTip.classList.remove('hidden');
                return;
            }

            data.forEach((item, index) => {
                const tr = document.createElement('tr');
                tr.className = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';
                tr.innerHTML = `
                    <td class="px-3 py-2 sm:px-4 border-b border-gray-200 text-no-vertical">${item.province}</td>
                    <td class="px-3 py-2 sm:px-4 border-b border-gray-200 text-no-vertical">${item.company}</td>
                    <td class="px-3 py-2 sm:px-4 border-b border-gray-200 text-no-vertical">${item.name}</td>
                    <td class="px-3 py-2 sm:px-4 border-b border-gray-200 text-no-vertical">${item.position}</td>
                    <td class="px-3 py-2 sm:px-4 border-b border-gray-200 text-no-vertical">${item.phone}</td>
                    <td class="px-3 py-2 sm:px-4 border-b border-gray-200 text-center">
                        <button 
                            class="view-projects px-2 py-1 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm text-no-vertical"
                            data-projects='${JSON.stringify(item.projects)}'
                        >
                            <i class="fa fa-list mr-1"></i>查看关联项目
                        </button>
                    </td>
                `;
                contactTable.appendChild(tr);
            });

            // 绑定查看项目按钮事件
            document.querySelectorAll('.view-projects').forEach(btn => {
                btn.onclick = function() {
                    const projects = JSON.parse(this.dataset.projects);
                    showProjectsModal(projects);
                };
            });
        }

        // 显示关联项目弹窗
        function showProjectsModal(projects) {
            projectList.innerHTML = '';
            
            if (projects.length === 0) {
                projectList.innerHTML = '<p class="text-gray-500 text-center py-2 text-no-vertical">暂无关联项目</p>';
            } else {
                const ul = document.createElement('ul');
                ul.className = 'list-disc pl-5 space-y-2';
                projects.forEach(project => {
                    const li = document.createElement('li');
                    li.className = 'text-no-vertical';
                    li.textContent = project;
                    ul.appendChild(li);
                });
                projectList.appendChild(ul);
            }

            projectModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        // 关闭弹窗
        function closeModalFunc() {
            projectModal.classList.add('hidden');
            document.body.style.overflow = '';
        }

        // 初始化事件监听
        function initEvents() {
            // 单位筛选输入事件
            const companyFilterInput = document.getElementById('companyFilterInput');
            companyFilterInput.addEventListener('input', function() {
                const keyword = this.value.trim();
                renderCompanySuggestions(keyword);
            });

            // 点击页面空白处关闭单位建议框
            document.addEventListener('click', function(e) {
                const companyInputEl = document.getElementById('companyFilterInput');
                if (!companyInputEl.contains(e.target) && !companySuggestions.contains(e.target)) {
                    companySuggestions.classList.add('hidden');
                }
            });

            // 清除单位筛选按钮事件
            clearCompanyFilterBtn.addEventListener('click', clearCompanyFilter);

            // 重置按钮事件（清空所有筛选）
            resetBtn.addEventListener('click', function() {
                clearCompanyFilter();
                initTable(contactData);
            });

            // 弹窗关闭事件
            closeModal.onclick = closeModalFunc;
            confirmModal.onclick = closeModalFunc;

            // 点击弹窗外层关闭
            projectModal.addEventListener('click', function(e) {
                if (e.target === projectModal) {
                    closeModalFunc();
                }
            });

            // 移动端表格滚动优化
            const tableContainer = document.querySelector('.table-responsive');
            tableContainer.addEventListener('touchstart', function() {
                this.style.scrollBehavior = 'auto';
            });
        }

        // 页面初始化
        window.addEventListener('DOMContentLoaded', function() {
            // 处理数据
            contactData = processTemplateData(templateData);
            // 初始化表格
            initTable(contactData);
            // 初始化事件
            initEvents();
        });
    </script>
</body>
</html>